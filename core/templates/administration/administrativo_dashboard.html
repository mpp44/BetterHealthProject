<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Panel Administrativo</title>
    <style>
        /* Reset y estilos base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f7f9;
            color: #333;
            line-height: 1.6;
        }

        /* Contenedor principal: menú lateral + contenido */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Menú lateral izquierdo */
        aside {
            background: #2c3e50;
            color: #ecf0f1;
            width: 250px;
            padding: 30px 20px;
        }

        aside h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        aside ul {
            list-style: none;
        }

        aside ul li {
            margin-bottom: 15px;
        }

        aside ul li a {
            color: #ecf0f1;
            text-decoration: none;
            display: block;
            padding: 10px 15px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        aside ul li a:hover {
            background: #34495e;
        }

        .menu-link {
            display: flex;
            align-items: center;
            gap: 10px; /* Espacio entre el icono y el texto */
            padding: 10px 15px;
            border-radius: 4px;
            transition: background 0.3s;
            color: #ecf0f1;
            text-decoration: none;
        }

        .menu-link:hover {
            background: #34495e;
        }

        .menu-link .icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            color: #ecf0f1;
        }

        /* Área principal de contenido */
        main {
            flex: 1;
            padding: 30px 40px;
        }

        main h1 {
            margin-bottom: 20px;
        }

        /* Tarjetas para cada sección */
        .card {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #ececec;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            margin-bottom: 15px;
        }

        /* Secciones de contenido, inicialmente ocultas salvo la primera */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .messages {
            list-style: none;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e0ffe0;
            border: 1px solid #70c470;
            color: #2d662d;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 15px;
        }

        table th, table td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: left;
        }

        /* Formularios */
        form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        form input,
        form select,
        form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        form button,
        form input[type="submit"] {
            background: #2c3e50;
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 15px;
        }

        form button:hover,
        form input[type="submit"]:hover {
            background: #34495e;
        }


    </style>
</head>
<body>
<div class="container">
    <aside>
        <h2>Better Health</h2>
        <ul>
            <li>
                <a href="#" onclick="showSection('usuarios')" class="menu-link">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                         viewBox="0 0 24 24" aria-hidden="true">
                        <path fill-rule="evenodd"
                              d="M12 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm-2 9a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-1a4 4 0 0 0-4-4h-4Z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span><b>Pacientes</b></span>
                </a>
            </li>
            <li>
                <a href="#" onclick="showSection('services')" class="menu-link">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true"
                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                         viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M2 6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6Zm4.996 2a1 1 0 0 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM11 8a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-6Zm-4.004 3a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM11 11a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-6Zm-4.004 3a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM11 14a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-6Z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span><b>Servicios</b></span>
                </a>
            </li>
            <li>
                <a href="#" onclick="showSection('citas')" class="menu-link">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true"
                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                         viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M5 5a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1h1a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1h1a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1 2 2 0 0 1 2 2v1a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a2 2 0 0 1 2-2ZM3 19v-7a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Zm6.01-6a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm2 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm-10 4a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm2 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span><b>Citas</b></span>
                </a>
            </li>

            <li>
                <a href="#" onclick="showSection('realizar-cita')" class="menu-link">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true"
                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                         viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M18 5.05h1a2 2 0 0 1 2 2v2H3v-2a2 2 0 0 1 2-2h1v-1a1 1 0 1 1 2 0v1h3v-1a1 1 0 1 1 2 0v1h3v-1a1 1 0 1 1 2 0v1Zm-15 6v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-8H3ZM11 18a1 1 0 1 0 2 0v-1h1a1 1 0 1 0 0-2h-1v-1a1 1 0 1 0-2 0v1h-1a1 1 0 1 0 0 2h1v1Z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span><b>Realizar Cita</b></span>
                </a>
            </li>

            <li>
                <a href="{% url 'admin_logout' %}" class="menu-link">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true"
                         xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M18 18V6h-5v12h5Zm0 0h2M4 18h2.5m3.5-5.5V12M6 6l7-2v16l-7-2V6Z"/>
                    </svg>
                    <span>Cerrar sesión</span>
                </a>
            </li>


        </ul>
    </aside>

    <main>
        <h1>Bienvenido al Panel Administrativo</h1>

        <!-- Mensajes de éxito -->
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        <!-- Sección: Usuarios -->
        <div id="usuarios" class="section {% if active_section == 'usuarios' %}active{% endif %}">
            <div class="card">

                <!-- Tabla de pacientes registrados -->
                <h3><b>PACIENTES REGISTRADOS</b></h3>
                <table>
                    <thead>
                    <tr>
                        <th>Nombre de Usuario</th>
                        <th>Correo Electrónico</th>
                        <th>Número de Afiliado</th>
                        <th>Fecha de Nacimiento</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for profile in usuarios %}
                    <tr>
                        <td>{{ profile.user.username }}</td>
                        <td>{{ profile.user.email }}</td>
                        <td>{{ profile.numero_afiliado|default:"-" }}</td>
                        <td>
                            {% if profile.fecha_nacimiento %}
                            {{ profile.fecha_nacimiento|date:"d/m/Y" }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4">No hay pacientes registrados.</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <!-- Formulario para crear un nuevo usuario -->
                <h3><b>AÑADIR NUEVO PACIENTE</b></h3>
                <form method="post" action="">
                    {% csrf_token %}
                    <!-- Campo oculto para identificar el formulario -->
                    <input type="hidden" name="create_user" value="1">

                    <label for="username">Nombre de Usuario:</label>
                    <input type="text" id="username" name="username" required>

                    <label for="email">Correo Electrónico:</label>
                    <input type="email" id="email" name="email" required>

                    <label for="numero_afiliado">Número de Afiliado:</label>
                    <input type="text" id="numero_afiliado" name="numero_afiliado">

                    <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
                    <input type="date" id="fecha_nacimiento" name="fecha_nacimiento">

                    <button type="submit">Crear Usuario</button>
                </form>
            </div>
        </div>


        <!-- Sección: Citas -->
        <div id="citas" class="section {% if active_section == 'citas' %}active{% endif %}">
            <div class="card">
                <h3><b>VALIDAR CITAS</b></h3>
                <!-- Formulario para buscar citas de un usuario concreto -->
                <form method="POST" action="{% url 'administrativo_dashboard' %}">
                    {% csrf_token %}
                    <div>
                        <label for="user_id">Selecciona usuario:</label>
                        <select name="user_id" id="user_id">
                            {% for profile in usuarios %}
                            <option value="{{ profile.user.id }}">{{ profile.user.get_full_name }} ({{ profile.user.username }})
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit" name="search" value="1">Buscar citas</button>
                    </div>
                </form>

                <!-- Listado de citas del usuario seleccionado -->
                {% if appointments %}
                <form method="POST" action="{% url 'administrativo_dashboard' %}">
                    {% csrf_token %}
                    <table>
                        <thead>
                        <tr>
                            <th>Servicio</th>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Confirmada</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for appointment in appointments %}
                        <tr>
                            <td>{{ appointment.service.name }}</td>
                            <td>{{ appointment.fecha|date:"Y-m-d" }}</td>
                            <td>{{ appointment.hora|time:"H:i" }}</td>
                            <td>
                                {% if appointment.confirmada %}
                                <input type="checkbox" checked disabled>
                                {% else %}
                                <input type="checkbox" name="appointment_ids" value="{{ appointment.id }}">
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit">Validar citas seleccionadas</button>
                </form>
                {% endif %}

                <!-- Citas canceladas -->
                {% if citas_canceladas %}
                <h3><b>CITAS CANCELADAS</b></h3>
                <table>
                    <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Servicio</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for cita in citas_canceladas %}
                    <tr>
                        <td>{{ cita.user.username }}</td>
                        <td>{{ cita.service.name }}</td>
                        <td>{{ cita.fecha }}</td>
                        <td>{{ cita.hora }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">No hay citas canceladas.</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                {% endif %}

                <!-- Citas confirmadas -->
                {% if citas_realizadas %}
                <h3><b>CITAS REALIZADAS</b></h3>
                <table>
                    <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Servicio</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for cita in citas_realizadas %}
                    <tr>
                        <td>{{ cita.user.username }}</td>
                        <td>{{ cita.service.name }}</td>
                        <td>{{ cita.fecha }}</td>
                        <td>{{ cita.hora }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">No hay citas realizadas.</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                {% endif %}
                <h3><b>CITAS PROGRAMADAS</b></h3>
                <!-- Formulario para filtrar el calendario semanal por servicio y semana -->
                <form method="post">
                    {% csrf_token %}
                    <label for="service_filter">Selecciona el servicio:</label>
                    <select name="service_id" id="service_filter" required>
                        <option value="">-- Seleccionar servicio --</option>
                        {% for s in services %}
                        <option value="{{ s.id }}">{{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <label for="week_start">
                        Selecciona una fecha para definir la semana (se calculará el lunes de esa semana y se mostrarán
                        las citas de lunes a viernes):
                    </label>
                    <input type="date" name="week_start" id="week_start">
                    <!-- Campo oculto para identificar la acción -->
                    <input type="hidden" name="filter_weekly_calendar" value="1">
                    <button type="submit">Ver Calendario Semanal</button>
                </form>

                <!-- Calendario Semanal: se muestra si existen citas filtradas -->
                {% if weekly_appointments %}
                <h4>Calendario Semanal</h4>
                <table>
                    <thead>
                    <tr>
                        <th>Día</th>
                        <th>Hora</th>
                        <th>Tipo de Servicio</th>
                        <th>Paciente</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for appointment in weekly_appointments %}
                    <tr>
                        <td>{{ appointment.fecha|date:"D d M Y" }}</td>
                        <td>{{ appointment.hora|time:"H:i" }}</td>
                        <td>{{ appointment.service.type }}</td>
                        <td>{{ appointment.user.username }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4">No hay citas programadas para este servicio en la semana seleccionada.</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>

        <!-- Sección: Servicios -->
        <div id="services" class="section {% if active_section == 'services' %}active{% endif %}">
            <div class="card">
                <h3><b>SERVICIOS</b></h3>
                <!-- Tabla de servicios -->
                <h4>Listado de Servicios:</h4>
                <table>
                    <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Descripción</th>
                        <th>Tipo</th>
                        <th>Precio (€)</th>
                        <th>Seguro</th>
                        <th>Duración (min)</th>
                        <th>Autorización</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for service in services %}
                    <tr>
                        <td>{{ service.name }}</td>
                        <td>{{ service.description }}</td>
                        <td>{{ service.type }}</td>
                        <td>{{ service.price }}</td>
                        <td>{{ service.insurance|yesno:"Sí,No" }}</td>
                        <td>{{ service.duration }}</td>
                        <td>{{ service.authorization|yesno:"Sí,No" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7">No se han registrado servicios.</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <!-- Formulario para agregar servicio manualmente -->
                <h3><b>AÑADIR SERVICIO (MANUAL)</b></h3>
                <form method="post">
                    {% csrf_token %}
                    <!-- Campo oculto para diferenciar la acción -->
                    <input type="hidden" name="create_service" value="1">

                    <label for="service_name">Nombre del Servicio:</label>
                    <input type="text" name="service_name" id="service_name" required>

                    <label for="description">Descripción:</label>
                    <textarea name="description" id="description" required></textarea>

                    <label for="type">Tipo:</label>
                    <input type="text" name="type" id="type" required>

                    <label for="price">Precio (€):</label>
                    <input type="number" step="0.01" name="price" id="price" required>

                    <label for="insurance">¿Requiere Seguro?</label>
                    <input type="checkbox" name="insurance" id="insurance">

                    <label for="duration">Duración (min):</label>
                    <input type="number" name="duration" id="duration" required>

                    <label for="authorization">¿Requiere Autorización?</label>
                    <input type="checkbox" name="authorization" id="authorization">

                    <button type="submit">Agregar Servicio</button>
                </form>

                <!-- Formulario para importar servicios mediante CSV -->
                <h3><b>AÑADIR SERVICIOS (AUTOMÁTICO)</b></h3>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="upload_csv" value="1">

                    <label for="csv_file">Selecciona el archivo CSV:</label>
                    <input type="file" name="csv_file" id="csv_file" accept=".csv" required>

                    <button type="submit">Importar CSV</button>
                </form>
            </div>
        </div>


        <!-- Sección: Realizar Cita -->
        <div id="realizar-cita" class="section {% if active_section == 'realizar-cita' %}active{% endif %}">
            <div class="card">
                <h3>Realizar Cita</h3>
                <p>Utiliza el siguiente formulario para agendar una nueva cita.</p>
                <form method="POST">
                    {% csrf_token %}
                    <label for="cliente">Cliente:</label>
                    <input type="text" name="cliente" id="cliente" placeholder="Nombre del cliente" required>

                    <label for="fecha">Fecha:</label>
                    <input type="date" name="fecha" id="fecha" required>

                    <label for="hora">Hora:</label>
                    <input type="time" name="hora" id="hora" required>

                    <label for="detalle">Detalle:</label>
                    <textarea name="detalle" id="detalle" placeholder="Detalles de la cita" rows="4"></textarea>

                    <input type="submit" value="Agendar Cita">
                </form>
            </div>
        </div>
    </main>
</div>

<script>
    function showSection(sectionId) {
        var sections = document.querySelectorAll('.section');
        sections.forEach(function (section) {
            section.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');
    }


</script>
</body>
</html>